
## 1 概述
条件格式指的是根据预定的条件为数据标记特殊的颜色或图标，突出某些重要或异常的数据，增强数据分析能力。
当前支持的条件格式类型有：**文字/背景色、文字、图标集** ，且只支持 **明细表、汇总表、交叉表、指标看板、文本** 五类组件。
不同的组件支持的条件格式类型说明：
● 明细表/汇总表/交叉表：文字/背景色、图标集。
● 指标看板/文本：文字、图标集。
## 2 条件格式功能说明
### 2.1 添加条件格式
下面以汇总表为例，通过一个简单的示例演示如何添加条件格式。
1、场景描述：希望能直观地看出各省份销售额相比上一年的升降情况，效果如下图所示：
2、使用产品内置Demo资源的“订单模型”作为数据来源，制作如下图所示的汇总表：
3、在组件设置的属性面板中，点击**添加条件格式****销售额** ，进入到条件格式设置界面。
  * 指标看板组件，设置条件格式时不支持选择 **提示** 上的字段。
  * 下拉面板中只支持选择当前组件未设置过条件格式的字段。


4、在条件格式设置的弹窗中，选择**图标集** ，配置规则以及图标的样式效果，点击 **确定** ，设置内容如下图所示：
  * 当本期的销售额大于销售额同期值时，使用绿色的上升图标标记。
  * 当本期的销售额等于销售额同期值时，使用黄色的持平图标标记。
  * 当本期的销售额小于销售额同期值时，使用红色的下降图标标记。


5、可在表格上查看效果。比如 **辽宁省** 本期的销售额：36836.4，大于销售额同期值：32513.74，所以标记为绿色的上升图标。
### 2.2 编辑条件格式
在组件设置的属性面板中，找到对应的字段，点击，进入到条件格式设置界面，修改配置规则和告警样式效果。
### 2.3 删除条件格式
1、入口1：在组件设置的属性面板中，找到对应的字段，点击，删除该字段上的条件格式。
2、入口2：在组件设置的属性面板中，鼠标移到选择字段框中，点击，删除该字段上的条件格式。
## 3 场景示例
以产品内置Demo资源的“订单模型”作为数据来源，介绍各种条件格式功能的相关使用场景。
### 3.1 突出显示数据为空的项
1、场景描述：产品季度销售分析的表格中，针对数据为空的异常项，需要标识单元格背景色为红色（以交叉表为例），效果如下图所示：
2、操作步骤：
（1）表格中包含三个字段：产品名称、年季、销售额，为 **销售额** 字段添加条件格式，功能入口介绍详见本文的 2.1章节。
（2）在条件格式设置弹窗中，条件格式类型为 **文字/背景** ，操作符类型选择 **为空** ，设置单元格背景色为 **红色** ，点击 **确定** ，设置内容和效果如下图所示：
  * 操作符是 **为空和不为空** 时，操作符右侧的比较值框置灰，不需要填入内容。


### 3.2 突出显示整行内容
1、场景描述：省份销售分析的表格中，由于业务要求需要重点关注辽宁省的数据，所以辽宁省所在的行，整行的文字都显示为蓝色（以汇总表为例），效果如下图所示：
2、操作步骤：
（1）表格中包含三个字段：发货区域、省份、销售额，为 **省份** 字段添加条件格式，功能入口介绍详见本文的 2.1章节。
（2）在条件格式设置弹窗中，条件格式类型为 **文字/背景** ，勾选 **应用于整行** ，操作符类型选择**等于** ，比较值选择 **辽宁省** ，设置文字颜色为 **蓝色** ，点击 **确定** ，设置内容和效果如下图所示：
  * 应用于整行 ：此功能仅支持清单表和汇总表的文字/背景类型。


### 3.3 标记指标数据的升降
1、场景描述：查看不同月份的销售额时，为方便观察数据的变化情况，希望通过箭头方向标识数据的升降（以指标看板为例），效果如下图所示：
2、操作步骤：
（1）指标看板组件中包含3个字段：销售额、同期增长率、环比增长率，通过年月筛选器切换选择不同月份，查看对应月份的销售额及销售额变化情况，原始效果如下：
（2）为 **同期增长率和环比增长率** 字段分别添加条件格式，功能入口介绍详见本文的 2.1章节。
（3）同期增长率和环比增长率的条件格式设置类似，下面以同期增长率为例对功能进行说明。在条件格式设置弹窗中，条件格式类型为 **图标集** ，配置规则以及图标的样式效果，点击 **确定** ，设置内容和效果如下图所示：
  * 当同期增长率大于0时，使用绿色的向上箭头图标标记。
  * 当同期增长率等于0时，使用黄色的持平横线图标标记。
  * 当同期增长率小于0时，使用红色的向下箭头图标标记。


3、图标集功能更多说明：
选择图标组 | 选择一组内置图标组，系统会根据所选图标组的图标个数自动生成对应数量的条件。  
---|---  
图标位置 | 设置满足条件时，图标显示的位置是相对字段值的左边/右边。  
图标 | 设置满足条件时，显示哪个图标。  
图标颜色 | 设置满足条件时，图标显示什么颜色。  
### 3.4 标记相对日期
1、场景描述：据当前日期高亮显示上周的数据，比如当前日期为2023-06-08，上周即为2023-05-29 ~ 2023-06-04（以汇总表为例），效果如下图所示：
2、前提条件：
（1）本示例中使用到的数据：wiki示例-产品明细数据.xlsx 。
（2）将上述数据导入到数据模型中，并保存该数据模型，功能详见：导入文件数据 。
（3）在仪表盘中创建组件时，业务数据集选择上述步骤2中创建的数据模型。
3、操作步骤：
（1）表格中包含两个个字段：日期、销售金额，为 **日期** 字段添加条件格式，功能入口介绍详见本文的 2.1章节。
（2）在条件格式设置弹窗中，条件格式类型为 **文字/背景** ，操作符类型选择**相对日期** ，比较值选择 **上周** ，设置文字颜色为 **紫色** ，单元格背景色为 **黄色** ，点击 **确定** ，设置内容和效果如下图所示：
3、相对日期功能更多说明：
为日期类字段设置条件格式时，操作符支持选择“相对日期”，根据当前日期动态计算相对日期并告警。
其中，日期类字段指：字段类型为日期型、日期时间型的字段，以及时间层次字段。
当前系统日期的前一天。  
---  
本周 | 当前系统日期所在的这个星期。  
上周 | 当前系统日期的上一个星期。  
本月 | 当前系统日期所在的这个月。  
上月 | 当前系统日期的上一个月。  
最近七天 | 包含今天的最近七天。  
最近三十天 | 包含今天的最近三十天。  
本周到昨天 | 本周的起始天到昨天。  
本月到昨天 | 本月1号到昨天。  
本季到昨天 | 本季第一个月的1号到昨天。  
本年到昨天 | 本年1月1号到昨天。  
自定义 |  自定义相对当前系统日期的日期范围。比如希望告警显示前3个月的数据，则设置起始日期为前3月，截止日期为前1月，如下图所示： 若起始日期或截止日期不勾选，则表示无起始日期或无截止日期，比如希望告警所有上月之前的所有数据，如下图所示：  
当前系统日期指当前登录用户操作系统的日期。
## 4 更多功能说明
### 4.1 操作符类型
为不同类型的字段设置条件格式，可选择的操作符不一样。
字段类型 | 支持的操作符类型 | 效果图  
---|---|---  
数值型 | 等于、不等于、大于、大于等于、小于、小于等于、为空、不为空、介于。  
日期型 | 等于、不等于、大于、大于等于、小于、小于等于、为空、不为空、介于、相对日期。  
字符串 |  等于、不等于、包含、不包含、模糊匹配、不匹配、开头为、结尾为、开头不为、结尾不为、为空、不为空， 其中包含和不包含，能支持选择多个备选值。  
### 4.2 比较值
为不同类型的字段设置条件格式，支持填写比较值的形式不一样。
条件格式是以字段真实值做比较。
字段类型 | 支持的操作符类型 | 效果图  
---|---|---  
数值型 |  支持在字段选择框中选择字段，或在公式编辑框中输入数值，进行加减乘除四则运算。
  * 字段选择框：字段来源为已选择到指标区、度量值区上的度量字段。
  * 公式编辑框：在公式编辑框中可通过+ - * / 运算符，可以将动态字段和静态值结合起来做计算。如：销售额（同期值）*1.5+50。 对于 指标卡 组件，字段来源为已选择到 指标区、标记区上的度量字段

  
日期型 | 操作符选择 **普通操作符** 时，比较值框根据当前字段的时间层次类型，显示对应的频度日期控件。 |  以字段为“年季”时间层次类型为例，比较值显示年季频度日期控件。  
操作符选择 **相对日期** 时，支持根据 **当前系统日期** 动态计算相对日期，内置常用的相对日期类型包含：今天、昨天、本周、上周、本月、上月、最近七天、最近三十天、本周到昨天、本月到昨天、本季到昨天、本年到昨天、自定义。 |  以“最近三十天”为例， 当前日期为2023-06-08，设置 **最近三十天** ，则表格上将告警2023-05-09 ~ 2023-06-08 的数据。  
字符串 | 只支持和当前字段值比较。  
### 4.3 文本组件特殊说明
文本组件详细使用说明可参考 文本组件，本文仅针对文本组件如何使用条件格式进行详细说明。
#### 4.3.1 **引用文本组件本身的内容**
1、场景描述：对于文本组件上展示的数据，希望使用特殊的颜色和图标来标识数据的变化情况，效果如下图所示：
2、操作步骤：
（1）在文本组件上拖拽添加字段，行区：订单年份、发货区域；度量区：销售额、销售额（同期值），如下图所示：
（2）设置文本内容，通过鼠标单击数据预览区中的单元格，可直接将单元格中的内容插入到文本内容区中，点击确定，如下图所示：
（3）为 **销售额** 字段添加条件格式，功能入口介绍详见本文的 2.1章节。
（4）在条件格式设置弹窗中，条件格式类型为 **文字** ，配置规则以及对应样式效果，设置内容如下图所示：
（5）切换条件格式类型为 **图标集** ，配置规则以及图标的样式效果，点击 **确定** ，设置内容如下图所示：
（6）文本组件展示的内容，将根据具体数值显示对应的告警效果。
#### 4.3.2 **引用其他组件内容**
文本组件引用其他组件上的内容时，如果被引用的字段设置了文字颜色或图标集的条件格式时，则该字段上的字段值和条件格式会一起被引用到文本组件上，但单元格背景色条件格式不能被引用。
1、以汇总表为例，汇总表上文字/背景、图标集两种条件格式类型的设置内容及最终展示效果如下：
添加一个空白的文本组件，设置文本内容，并引用上述步骤1中的组件上的内容。
3、文本组件展示的内容，将根据表格动态显示告警效果。
### 4.4 文字条件格式类型
相比**文字/背景****文字**
### 4.5 条件优先级
1、同一个类型的条件格式，如果存在多个条件范围重叠时，样式生效顺序从上到下，即上方的条件效果优先生效。
2、当字段本身的条件格式和应用整行的条件格式在同个单元格都生效时，优先以字段本身条件格式样式显示。  

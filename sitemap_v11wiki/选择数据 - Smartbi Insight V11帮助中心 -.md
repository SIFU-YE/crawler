
数据即席查询的前提是要有数据。本文将介绍即席查询如何获取数据，即选择业务数据集。
即席查询如果想一次性查询多个事实表的数据，目前只支持基数关系为“一对一”的情况。
如果数据来源于 **数据源表** ，需要在数据连接/对应数据源下/ 表关系视图下修改对应的表基数关系。
## 1 操作入口
新建即席查询后，点击数据面板中的 **选择业务数据集** ，弹出选择业务数据集窗口，选择数据，如下图。
在选择业务数据集窗口，可以通过搜索关键字和目录查找的方式找到数据集。通过关键字搜索，搜索的内容可以是资源名称/别名、资源ID、资源描述。或者在 最近访问、（暂未实现） 、全部资源的tab页中，以目录的形式查找数据集。
即席查询支持的数据集类型，包括 **数据模型** 和 **数据源** 。以全部资源tab页为例，找到需要的数据模型或数据源，点击确定使用数据集。同时，还可以在操作列作中点击 **编辑** ，对数据集作进一步的编辑。
目前如果选择 **数据源，** 只能使用数据源下的 **表** 和业务视图下的 **SQL查询** ，业务视图下的 **可视化数据集** 和 **SQL数据集** 暂不支持。
当要切换数据集时，可以在数据面板选择框或者更多的下拉框选项中，点击 **切换业务数据集** ，如下图。
## 2 选择字段
在 **选择业务数据集** 窗口，确定你选择的数据集后，直接勾选你所需要查询的字段，或者拖拽字段字段到 **表格/列字段** 区域中。
即席查询定位于明细数据的查询，暂不支持查询计算度量、维度的复制转度量。
若需要勾选的字段较多，可以在目录上右键，或者点击目录右侧的按钮，在出现的菜单中选择全选子节点、全选子孙节点等批量勾选字段菜单。
## 3 数据设置
根据业务需要，可以对字段进行排序、显示名和数据格式等设置，最后在表格区展现了字段的明细数据查询结果，如下图。
  * **排序：** 根据选择的排序字段，对查询字段作排序，支持全局升序和全局降序。排序逻辑详见：数据排序逻辑。
  * **设置显示名：** 类似别名设置。设置一个更具有业务友好性的表格列名称，如产品库存、产品平均单价等。注：显示名只在表格列头和“表格/列字段”中生效，不会影响原数据集。
  * **数据格式：** 字段作数据格式的调整，支持整型、浮点型、百分比、自定义等多种数据格式类型。
  * **定位：** 字段“一键定位”到在原数据集的位置。


即席查询的表格字段和筛选器字段都不支持 **自定义排序** 。即席查询表格的排序逻辑和交互式仪表盘的明细表组件一致，排序逻辑详见：数据排序逻辑。
## 4 新建分组字段和计算列
有时现有数据模型中字段不能满足查询的需求，为了让数据查询有更多的灵活性，即席查询支持在数据模型和数据源中自定义维度，包括新建分组字段和新建计算列，可以查询分组字段和计算列的明细数据。
  * **分组字段：** 把字段（查询对象）作分组查询是常见的做法。比如我们把城市按照GDP分为“一线、二线、三线城市”等，把人的年龄按范围分为“青年、中年、老年”等。
  * **计算列：** 顾名思义，通过计算的方式在数据集中新增一列，计算的方式包括四则运算表达式和内置函数。比如在详细地址中截取省市信息，在身份证号中截取生日信息生成生日列。


2、在即席查询（前端应用）上新建分组字段和计算列时，支持选择私有分组字段、私有计算列。
### 4.1 新建分组字段
在数据面板的维度目录上点击，选择 **新建分组字段** ，如下图，以产品demo中的订单模型为例创建即席分析，统计不同产品类别在一线城市、二线城市和其他城市的销售情况。
  * **分组名称：** 新建分组字段的名称，如“城市分组”；
  * **分组字段：** 将订单表中的”发货城市“字段分组。注：不支持选择 度量、计算度量、命名集、计算成员
  * **存放路径：** 默认放在“自定义维度”目录下，不支持更改存放路径；
  *     * 枚举分组：支持用于字符串、数值和日期字段类型数据的分组；一般用于文本字段的分组，比如把城市按照GDP分为“一线、二线、三线城市”等。
    * 范围分组：支持用于数值和日期字段类型数据的分组，字符串类型不支持范围分组；一般用于数值字段的分组，比如把人的年龄按范围分为“青年、中年、老年”等。
    * 合并成一项：将分组外的数据合并为一项显示，用户可以自定义合并项的名称，比如”其他城市“
    * 保持原值：分组外的数据不做处理，直接按照原始值显示，比如“海南“仍显示为“海南“
  * **字段描述：** 用于分组字段的业务描述，可通过鼠标悬浮在分组字段上查看；


分组字段详情，请查看：分组字段
新建分组字段后，分组字段可作为条件过滤数据，及查看分组字段的明细数据，如下图。
### 4.2 新建计算列
在数据面板的维度目录上点击，选择 **新建计算列** ，如下图，以产品demo中的订单模型为例创建即席分析，从雇员表中的地址字段中，截取地址区域，查询雇员主要来自哪些区域。
  * **名称：** 新建计算列的名称，如“一级地址”；
  * **数据格式：** 计算列显示的数据格式；
  * **描述：** 用于计算列的业务描述，可通过鼠标悬浮在计算列上查看；
  * 选择基于哪些字段作二次计算，如选择雇员表中的地址字段；
  * 计算列支持常规的加减乘除，同样也支持更为复杂的函数计算；


计算列详情，请查看：计算列
新建计算列后，计算列可作为条件过滤数据，及查看计算列的明细数据，如下图。
### 4.3 更多数据处理功能
即席查询功能逻辑和仪表盘的明细表组件一样，更多数据处理功能详见：复制转度量、复制转维度。
选择数据来源并且对数据进行设置后，你已经具备了一批可用的数据。接下来，根据实际业务情况，一般会对数据进行过滤，找到你需要的最终数据。如何过滤数据，请阅读下一章节。
## 5 注意事项
1、数据模型的度量是字符串计数（例如计数用户ID），将该度量拖拽到即席查询，会显示计数前的数据。  

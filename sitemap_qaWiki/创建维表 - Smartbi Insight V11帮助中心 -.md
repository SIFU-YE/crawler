
## 1 概述
维表是一种数据表，数据表是由表名、表结构和表记录（表数据）等几部分组成。本文将介绍如何创建维表的表名、表结构、表数据。
## 2 新建维表的表结构
支持通过系统新建表、添加数据库的表和添加SQL查询三种方式创建维表，三种方式的适用场景如下：
  * 系统新建表：无数据仓库，无数据治理，指标模型直接对接原始业务库时，可通过梳理指标和维度关系时，帮助项目建立规范的维表和事实表。
  * 添加数据库的表：有数据仓库，有独立的数据治理团队，数据仓库中已梳理好了规范的维表和事实表。
  * 添加SQL查询：数据库中没有现成且满足要求的表，且又不希望再重新创建和维护新的表，则可使用SQL查询。


### 2.1 系统新建表
1、点击数据准备，进入已创建指标模型，选择 **存储管理** ，选择 **维表** ，点击 **新建** 一种维表类型，包括普通维表、日期维表。
2、点击一种维表类型，如“普通维表”，跳转到“新建维表”界面。
普通维表各功能说明如下：
名称 |  输入维表的名称，该名称是维表表在指标库中对应的物理表的别名。 输入内容：不允许包含非法字符“\/'|"*?%.><=:;()[]”。  
---|---  
表名 |  输入维表表的名称，该名称是维表在指标库中对应的物理表的名称，创建维表成功后，后续不允许在系统中修改。 输入内容：只能含有数字、字母、下划线，且不能以数字开头。  
维表结构 | 名称 | 输入维表字段的名称，该名称是维字段在物理表中表字段的名称，创建维表成功后，后续不允许在系统中修改。  
别名 | 输入维表字段的别名，该名称是维字段在物理表中表字段的别名。  
数据类型 | 选择维表字段的数据类型。  
数据格式 | 选择维表字段的数据格式。  
主键 | 设置维表字段是否是主键，一张维表有且仅有一个主键。  
允许为空 | 设置维表字段的数据是否允许为空。  
搜索 | 通过“名称”或“别名”关键字搜索匹配的维字段。  
排序 | 对当前维表下的字段进行排序操作，从左至右依次是：上移至顶、上移、下移、下移至底。  
如新建 **日期维表** ，跳转到“新建维表”界面。
日期维表各功能说明如下：
名称 |  输入维表的名称，该名称是维表在指标库中对应的物理表的别名。 输入内容：不允许包含非法字符“\/'|"*?%.><=:;()[]”。  
---|---  
表名 |  输入维表表的名称，该名称是维表在指标库中对应的物理表的名称。 输入内容：只能含有数字、字母、下划线，且不能以数字开头。  
开始日期/结束日期 | 选择开始及结束日期，格式为”YYYY-MM-DD“。  
日期字段名 | 输入日期维表主键字段名，主键字段数据格式为”YYYY-MM-DD“。  
时间频度 | 勾选时间频度，系统自动生成该频度字段及数据。  
自定义字段名 | 根据勾选的时间频度显示字段名的输入框。  
### 2.2 添加数据库的表
1、点击数据准备，进入已创建指标模型，选择 **存储管理** ，选择 **维表** ，点击 **添加 > 数据源表 **。
2、进入到“添加数据源表”的界面，可批量从左侧添加多张表到右侧选框内。
  * 添加表的范围：指标存储库关联的数据源下的表、视图，指标存储库相关操作指导请查看章节。
  * 可添加多个Schema下的表、视图。
  * 在维表中，同一张表、视图只支持添加1次。
  * 同一个表、视图支持在维表和事实表中分别导入。


3、点击 **保存** ，若添加的维表中无唯一主键字段，则会进入“设置维表主键”界面。
配置维表主键是为后续生成数据模型时，默认选择哪个字段和事实表关联。
4、由“添加数据源表”新建的维表，表结构统一在数据库中维护，系统支持从数据库中同步最新的表结构到指标模型中。
### 2.3 添加SQL查询
1、点击数据准备，进入已创建指标模型，选择 **存储管理** ，选择 **维表** ，点击 **添加 > SQL查询 **。
2、进入“新建SQL查询”界面，编写SQL后，点击工具栏上的 **保存** 。
3、将SQL查询结果作为维表结构，输入名称和设置主键字段，点击 **保存** ，完成维表的创建。
4、由“SQL查询”新建的维表，可通过 **编辑SQL查询** 更新维表结构。
## 3 实现维表的表数据
新建维表的表结构后，再实现维表的表数据，Smartbi 有两种方式实现表数据，分别是：**在线编辑** 数据、通过**绑定自助ETL** 实现灌数。
**在线编辑数据：** 在前端以Excel的形式提供在线编辑表数据的功能，适合业务或IT人员实现小批量数据的录入和修改。
**绑定自助ETL：** 通过ETL工具实现数据抽取、转换、加载，适合数据量较大并且对数据转换的要求比较高的情况，同时需要具备一定的ETL工具能力。
### 3.1 在线编辑数据
1、打开某个维表，点击**数据预览** ，查看维表数据。
2、点击右侧的 **在线编辑** ，打开在线编辑数据的窗口。
由于SQL查询的数据结果，可能是通过SQL语句查询多个表而来，所以无法根据输出的字段在线编辑数据并回写入库，故SQL查询不支持在线编辑数据。
在线编辑数据界面各操作项说明如下：
操作项 | 说明 | 效果图  
---|---|---  
列头 （下拉菜单） | 列宽 |  打开时，表格默认列宽是根据窗口宽度自适应显示。 调整列宽的方法： 列头下拉更多菜单中，可以自定义调整当前列的列宽。 ● 手动拖拽列右边界线，调整列宽 自定义的列宽暂时不支持保存。  
行头/选中整行 （右键菜单） | 复制 |  支持复制一整行的数据后，粘贴到当前窗口、本地文件等。 ● 在线编辑数据窗口的粘贴功能，目前只支持 Ctrl + V  
向上增加 n 行 | 在当前选中行上方插入 n 行空白行。  
向下增加 n 行 | 在当前选中行下方插入 n 行空白行。  
删除选中行 | 删除当前选中行。  
行高 |  调整行高的方法： ● 行头右键菜单中，可以自定义调整当前行的行高。 ● 手动拖拽行下边界线，调整行高 自定义的行高暂时不支持保存。  
清除内容 | 清除当前选中行里的全部内容  
单元格 （右键菜单） | 复制 |  支持复制当前单元格数据后，粘贴到当前窗口、本地文件等。 ● 在线编辑数据窗口的粘贴功能，目前只支持 Ctrl + V  
插入行 | 在当前选中单元格上方插入一行空白行。  
删除选中行 | 删除当前选中单元格所在的行。  
清除内容 | 清除当前选中单元格的内容。  
其他操作 | 填充 | 按照类EXCEL的填充规则，自动填充单元格内容  
撤销回退 | 支持通过键盘的 Ctrl + Z 撤销上一步操作  
信息
在线编辑限制说明
***** 目前暂时只支持小数据量的场景，默认限制表数据小于等于1000行时，才能进行在线编辑。日期维表数据是系统自动生成的，暂不支持在线编辑。
***** 表格数据默认是至少显示100行，如果表数据本身没有达100行时，会自动在数据下面增加空行补齐。
表格列是根据当前维表的字段自动显示，不支持增删列。
***** 默认会自动是冻结列头。
注意
在线编辑的数据对象是指标存储库中的数据，不会影响源业务系统数据。
### 3.2 绑定自助ETL
选择维表，**新建自助ETL** 。如已创建自助ETL，则对应的 **选择自助ETL** 即可。维表已绑定自助ETL后，支持 **打开自助ETL** 进行修改，或 **重新绑定** 或 **解除绑定** 自助ETL。
自助ETL的创建及设置详情请参见：自助ETL。  

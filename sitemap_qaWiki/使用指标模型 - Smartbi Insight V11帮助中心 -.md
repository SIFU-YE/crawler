
1 概述
指标模型可以应用于交互式仪表盘、电子表格、WEB电子表格、即席查询、NLA。数据模型是指标模型的底层数据引擎，所以，应用前需要将指标模型生成相应的数据模型。本文将介绍如何指标模型生成数据模型并作数据分析展现的应用。
## 2 生成数据模型
根据具体业务情况勾选所需的指标和维度生成对应数据模型，数据模型之间相互独立，业务用户可基于数据模型进行指标数据分析。
1、操作入口，在指标模型下的”模型管理“节点，在其更多菜单中选择新建命令菜单。
2、单击“新建 > 数据模型”，打开新建数据模型界面。勾选指标，右侧自动显示勾选指标关联的维度。
  * **公共维度：** 是指所有勾选的指标都关联的维度，且默认勾选全部公共维度。
  * **私有维度：** 当勾选的指标中，存在至少一个指标不关联该维度时，则为私有维度。私有维度默认不勾选。


3、点击 **保存** 生成数据模型后，在“模型管理”节点下生成对应数据模型，可直接双击打开数据模型查看转化后的数据模型结果。
  * 用户可以在数据模型中对维度进行再次加工或深度加工，详情请分别参见：创建维度及层次、创建计算成员、创建命名集。
  * 如果需要控制指标的数据权限，也是在生成的数据模型上进行配置，详情参见：数据模型行权限。


  * 存在以下情况时，会导致生成数据模型失败：
    * 维表和事实表关联字段的字段类型不一致。
    * 指标存储库连接不成功。
  * 生成数据模型时，若勾选了表达式为空的计算指标，则该计算指标不会生成到数据模型中。


4、生成的数据模型中，其维表和事实表的关系自动生成，指标模型与数据模型的转化对应关系如下：
指标模型对象 | 数据模型对象  
---|---  
指标分类 | 度量目录 | 所有要添加到数据模型中的指标对应的指标分类。  
指标 | 度量 | 若勾选了计算指标，则根据计算指标的表达式找到所有关联的原子指标，并全部添加到数据模型中。  
维度 | 数据模型目录 | 根据勾选的维度内容一一对应生成。  
维度属性 | 维度字段 |  ● 所勾选的维度中包含的所有维度属性。 ● 计算指标的表达式中，若包含维度属性、维度成员，自动将相关内容添加到数据模型中。  
层次结构 | 层次结构 |  ● 所勾选的维度中，若维度中包含层次结构，则添加到数据模型中。 ● 计算指标的表达式中，若包含层次字段，自动将层次结构添加到数据模型中。  
维表 | 基础表私有查询 | 根据勾选的维度找到所有关联的维表，将维表作为私有查询添加到数据模型中。  
事实表 |  ● 基础表私有查询 ● 数据模型目录（默认在报表上隐藏） ● 自动根据每个事实表生成布局视图 |  ● 根据所有关联的原子指标找到对应的事实表，将事实表表作为私有查询添加到数据模型中。 ● 具体事实表一一对应生成数据模型目录及字段。  
5、通过指标模型生成的数据模型，相对于独立的数据模型资源，暂不支持以下功能：另存、新建私有查询、生成和修改度量/计算度量、新建和编辑布局。独立的数据模型资源功能详见：数据模型。
## 3 同步数据模型
1、当指标模型中指标、维度、维表和事实表等发生变化时，需要同步最新指标模型结构到数据模型中。
2、在数据模型中进行修改或加工操作后，同步数据模型操作后对操作的处理情况如下：
自定义内容 | 同步后是否会覆盖自定义内容  
---|---  
修改表关系在数据模型中 |  否，会保存自定义效果。 只有用户在数据模型中手工定义的维表和维表、事实表和事实表之间的关系不会被覆盖；维表和事实表之间的关系还是会被覆盖，同步后覆盖成在指标模型中定义的关联关系。  
指标的汇总依据 | 是  
指标的数据格式 | 是  
指标的数据类型 | 是  
指标的业务口径（指标的字段描述） | 是  
指标分类的别名 | 是  
维度属性的别名 | 是  
层次结构的别名 | 是  
层级字段的别名 | 是  
层次结构的层级顺序 | 是  
维表字段的别名 | 是  
维表字段的数据类型 | 是  
维表字段的数据格式 | 是  
事实表的别名 | 是  
事实表字段的别名 | 是  
事实表字段的数据类型 | 是  
事实表字段的数据格式 | 是  
维度在报表中显示或者隐藏 | 否，会保存自定义效果  
字段标记为地理维度 | 否，会保存自定义效果  
字段迁移到其它维度目录 | 否，会保存自定义效果  
切换模型未抽取状态 | 否，会保存自定义效果。因为这个是模型的状态。  
## 4 交互式仪表盘应用
### 4.1 操作入口
点击 **数据准备** ，选择已构建的 **指标模型** ，选择此指标模型的 **模型管理** 的某个模型主题，然后选择新建 **新建 > 交互式仪表盘>自由布局/自适应布局**。
### 4.2 效果展示
交互式仪表盘定制详情，请参见：交互式仪表盘。
## 5 电子表格应用
指标模型应用于电子表格，必须先后具备如下条件指标：
1、生成数据模型。详情请参见：数据模型转化。
2、新建模型查询。详情请参见：新建模型查询。
### 5.1 新建模型查询
模型查询是在数据模型中查询出来的数据集，是数据模型和指标模型在电子表格中应用的前提条件。
#### 5.1.1 操作入口
在电子表格设计界面的右侧单击，弹出下拉菜单，选择 **新建模型查询** ：
如果是从旧版升上来的则需要先选择“数据集来源”为：报表数据集。
#### 5.1.2 模型查询窗口
模型查询设置窗口如下图所示：
该窗口分为如下几个区：
  * 模型搜索区：用于搜索数据模型或指标模型。该区有两个操作按钮：


过滤空目录：用于过滤掉“资源区”的维度和指标的空目录。
刷新：用于刷新“资源区”的维度和指标。
  * 资源区：显示所选模型的维度和指标，用于勾选需要输出的维度和指标字段。维度和指标栏有两个操作按钮：


开启/关闭维度和指标关联筛选：用于开启或关闭维度和指标关联筛选，该按钮的详情请参见：维度和指标关联筛选。
搜索：用于通过名称关键字搜索“维度”或“指标”。
  * 工具栏：用于显示“刷新”和“保存”按钮，其中刷新功能包含如下两个选项：


切换参数自动刷新：表示参数切换自动刷新数据。
修改报表自动刷新：表示报表修改后自动刷新数据。
  * 条件过滤区：用于从“资源区”拖拽字段设置过滤条件。


  * 输出列表区：显示用户在“资源区”勾选的输出字段列表，字段列对支持如下操作：


排序方式：支持对当前执行升序、降序和无序操作。
快速计算：支持对当前度量字段执行占比、排名、同比、前期、时间累计操作，其中“同比”、“前期”、“时间累计”这三个时间计算需要有时间信息才允许操作。时间计算的详情请参考：时间函数及逻辑。
属性：用于打开当前字段的“属性窗口”，修改别名、描述。
移动：支持对当前字段执行前移、后移、移至最前、移至最后操作。
移除：用于将当前字段从输出列表中删除。
模型查询的详情请参见：模型查询。
### 5.2 效果展示
1、在电子表格设计界面，右侧的模型查询“销售数据”中拖拽如下字段到表格。电子表格定制详情请参见：电子表格。
2、以上设置效果如下：  
